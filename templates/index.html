<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM</title>
    <link rel="stylesheet" href="../static/menu.css">
    <link rel="stylesheet" href="../static/content.css">
    <style>
        .version {
            position: fixed;
            left: 10px;
            bottom: 10px;
            font-size: 12px;
            color: #888;
        }
    </style>
</head>

<body>
    <a class="toggle-nav" href="#" onclick="toggleMenu(event)">&#9776;</a>

    <nav class="menu">
        <ul>
            <li class="current-item"><a href="#">Home</a></li>
            <!--<li><a href="/" target="_blank">Home</a></li>-->
            <li><a href="https://www.ragic.com/" target="_blank">Ragic</a></li>
            <li><a href="/login">Send Email</a></li>
            <li><a href="https://www.cancerfree.io/zh-tw/index" target="_blank">CancerFree</a></li>
            <li><a href="https://www.facebook.com/CancerFreeBiotech/" target="_blank">Facebook</a></li>
            <li><a href="https://www.linkedin.com/company/cancerfree-biotech/?originalSubdomain=tw"
                    target="_blank">Linkedin</a></li>
            <li><a href="https://www.youtube.com/channel/UCqvEm2rawS8cMXA1PVIn2Bg" target="_blank">Youtube</a></li>

        </ul>
    </nav>

    <div class="header">
        <div class="logo">
            <img src="static/logo.svg" alt="CancerFree Biotech">
        </div>
    </div>

    <div class="content">
        <h2>Upload Business Card for CRM System</h2>
        <form id="upload-form" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="file">Select Image:</label>
                <input type="file" id="file" name="file">
            </div>
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea id="description" name="description" rows="4" placeholder="Enter description"></textarea>
            </div>
            <input type="button" value="Upload" class="button" onclick="uploadFile()">
        </form>
        <div id="result" class="uploaded-data" style="display: none;">
            <h3>Uploaded Data:</h3>
            <div id="filename-display"></div>
            <form id="confirm-form">
                <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="company">Company:</label>
                    <input type="text" id="company" name="company">
                </div>
                <div class="form-group">
                    <label for="department1">Department 1:</label>
                    <input type="text" id="department1" name="department1">
                </div>
                <div class="form-group">
                    <label for="department2">Department 2:</label>
                    <input type="text" id="department2" name="department2">
                </div>
                <div class="form-group">
                    <label for="title1">Title 1:</label>
                    <input type="text" id="title1" name="title1">
                </div>
                <div class="form-group">
                    <label for="title2">Title 2:</label>
                    <input type="text" id="title2" name="title2">
                </div>
                <div class="form-group">
                    <label for="title3">Title 3:</label>
                    <input type="text" id="title3" name="title3">
                </div>
                <div class="form-group">
                    <label for="email1">Email 1:</label>
                    <input type="text" id="email1" name="email1">
                </div>
                <div class="form-group">
                    <label for="email2">Email 2:</label>
                    <input type="text" id="email2" name="email2">
                </div>
                <div class="form-group">
                    <label for="mobile1">Mobile 1:</label>
                    <input type="text" id="mobile1" name="mobile1">
                </div>
                <div class="form-group">
                    <label for="mobile2">Mobile 2:</label>
                    <input type="text" id="mobile2" name="mobile2">
                </div>
                <div class="form-group">
                    <label for="tel1">Tel 1:</label>
                    <input type="text" id="tel1" name="tel1">
                </div>
                <div class="form-group">
                    <label for="tel2">Tel 2:</label>
                    <input type="text" id="tel2" name="tel2">
                </div>
                <div class="form-group">
                    <label for="fax1">Fax 1:</label>
                    <input type="text" id="fax1" name="fax1">
                </div>
                <div class="form-group">
                    <label for="fax2">Fax 2:</label>
                    <input type="text" id="fax2" name="fax2">
                </div>
                <div class="form-group">
                    <label for="address1">Address 1:</label>
                    <input type="text" id="address1" name="address1">
                </div>
                <div class="form-group">
                    <label for="address2">Address 2:</label>
                    <input type="text" id="address2" name="address2">
                </div>
                <div class="form-group">
                    <label for="website">Website:</label>
                    <input type="text" id="website" name="website">
                </div>
                <div class="form-group">
                    <label for="confirm-description">Description:</label>
                    <textarea id="confirm-description" name="description" rows="4"></textarea>
                </div>
                <input type="button" value="Confirm" class="button" onclick="confirmData()">
            </form>
        </div>

        <div class="version">v.1</div>

        <script>
            function toggleMenu(event) {
                event.preventDefault();
                document.querySelector('.menu').classList.toggle('active');
                document.querySelector('.toggle-nav').classList.toggle('active');
            }

            async function uploadFile() {
                const form = document.getElementById('upload-form');
                const formData = new FormData(form);

                try {
                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();

                    if (result.success) {
                        // Display filename
                        document.getElementById('filename-display').innerHTML = `<p><strong>Filename:</strong> ${result.data.filename}</p>`;

                        // Populate other form fields
                        document.getElementById('name').value = result.data.name || '';
                        document.getElementById('company').value = result.data.company || '';
                        document.getElementById('department1').value = result.data.department1 || '';
                        document.getElementById('department2').value = result.data.department2 || '';
                        document.getElementById('title1').value = result.data.title1 || '';
                        document.getElementById('title2').value = result.data.title2 || '';
                        document.getElementById('title3').value = result.data.title3 || '';
                        document.getElementById('email1').value = result.data.email1 || '';
                        document.getElementById('email2').value = result.data.email2 || '';
                        document.getElementById('mobile1').value = result.data.mobile1 || '';
                        document.getElementById('mobile2').value = result.data.mobile2 || '';
                        document.getElementById('tel1').value = result.data.tel1 || '';
                        document.getElementById('tel2').value = result.data.tel2 || '';
                        document.getElementById('fax1').value = result.data.fax1 || '';
                        document.getElementById('fax2').value = result.data.fax2 || '';
                        document.getElementById('address1').value = result.data.address1 || '';
                        document.getElementById('address2').value = result.data.address2 || '';
                        document.getElementById('website').value = result.data.website || '';
                        document.getElementById('confirm-description').value = result.data.description || '';

                        // Show the result section
                        document.getElementById('result').style.display = 'block';
                    } else {
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error uploading file:', error);
                    alert('Error uploading file.');
                }
            }

            async function confirmData() {
                const form = document.getElementById('confirm-form');
                const formData = new FormData(form);

                try {
                    const response = await fetch('/confirm', {
                        method: 'POST',
                        body: formData
                    });
                    const result = await response.json();

                    if (result.success) {
                        alert('Data confirmed successfully!');
                        window.location.reload();
                    } else {
                        alert('Error: ' + result.error);
                    }
                } catch (error) {
                    console.error('Error confirming data:', error);
                    alert('Error confirming data.');
                }
            }
        </script>
</body>

</html>